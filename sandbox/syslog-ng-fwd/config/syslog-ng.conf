#
# syslog-ng configuration
# Generated from syslog-fwd config on 2026-02-05 08:57:23
#
# WARNING: This is an auto-generated configuration.
# Some features may require manual adjustment.
#

@version: 4.0
@include "scl.conf"

# Global options
options {
    time-reap(30);
    mark-freq(10);
    keep-hostname(yes);
    chain-hostnames(no);
    use-dns(no);
    dns-cache(no);
    use-fqdn(no);
    create-dirs(yes);
    keep-timestamp(yes);
};

# ======================================================================
# Sources
# ======================================================================

# Source: udp-514
source s_udp_514 {
    network(
        transport("udp")
        port(514)
    );
};

# Source: tcp-514
source s_tcp_514 {
    network(
        transport("tcp")
        port(514)
        flags(syslog-protocol)
    );
};

# ======================================================================
# Destinations
# ======================================================================

# Destination: receiver
destination d_receiver {
    network(
        "syslog-receiver"
        transport("tcp")
        port(514)
        template("<${PRI}>1 ${ISODATE} ${HOST} ${PROGRAM} ${PID} ${MSGID} ${SDATA} ${MSG}\n")
    );
};

# ======================================================================
# Rewrites (transforms)
# ======================================================================

# Rewrite: anonymize-ip
rewrite r_anonymize_ip {
        subst("\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b", "x.x.x.x", value("MSG"), flags(global));
};

# Rewrite: remove-pid
rewrite r_remove_pid {
        set("" value("PID"));
};

# Rewrite: mark-forwarded
rewrite r_mark_forwarded {
        set("[FWD] ${MSG}" value("MSG"));
};

# ======================================================================
# Filters
# ======================================================================

# Filter: security-logs
filter f_security_logs {
    (facility(auth) or facility(authpriv));
};

# Filter: drop-debug
filter f_drop_debug {
    level(debug);
};

# Filter: default (matches all)
filter f_default {
    level(debug..emerg);
};

# ======================================================================
# Log paths
# ======================================================================

# Log paths
# Log path: security-logs
log {
    source(s_udp_514); source(s_tcp_514);
    filter(f_security_logs);
    rewrite(r_anonymize_ip);
    destination(d_receiver);
    flags(final);
};

# Log path: drop-debug (DROP)
log {
    source(s_udp_514); source(s_tcp_514);
    filter(f_drop_debug);
    flags(final);
};

# Log path: default
log {
    source(s_udp_514); source(s_tcp_514);
    filter(f_default);
    rewrite(r_remove_pid); rewrite(r_mark_forwarded);
    destination(d_receiver);
    flags(final);
};

